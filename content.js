// Language configuration
let currentLang = 'en';
const supportedLanguages = ['en'];
const htmlLang = document.documentElement.lang?.slice(0, 2).toLowerCase() || 'en';

// Replacement data
const replacementData = {
    'en': {
        singular: {
            terms: /\b\w+\b/g,
            replacement: ['words', 'Words'],
        },
    },
};

// Precompile regular expression
const compiledRegex = replacementData[currentLang].singular.terms;

// Optimized replaceTextContent function
function replaceTextContent(text) {
    const [replacement, replacementUpper] = replacementData[currentLang].singular.replacement;
    return text.replace(compiledRegex, match =>
        match[0] === match[0].toUpperCase() ? replacementUpper : replacement
    );
}

// Replace all <img> src attributes
function replaceImages() {
    document.querySelectorAll('img').forEach(img => {
        img.src = 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAE2ATYDAREAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD+/igAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoA/MP/gpF8VPiL8NLf4Pj4f8AjfX/AAY+tyePzqjaFfPYtqCaWng02huGRlE32MX92IImzzdyMMEcgHwzofjX9ufxLo1hreheIfjtqujanG02nanbXN9Jb3UUZCSss0EnmMd7rtDHZtz3C0BzKOrV+m1/62NT+1/2/f8AoJfHr/wI1n/45SaqP+Gk5dbpPT5+dhe1X8q+5f5h/a/7fv8A0Evj1/4Eaz/8cpcmK/lj/wCAx/yD2q/lX3L/ADD+1/2/f+gl8ev/AAI1n/45RyYr+WP/AIDH/IPar+Vfcv8AMP7X/b9/6CXx6/8AAjWf/jlNRrL+JFKPSyS1+XlcPar+Vfcv8zkfHfj3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4otI7LXNIe7v7Bb23hure+ijN3pl1Z30QS7tbeb9xcx7/L8uXfC8kbgHyC3/AATK/YlYsT8FocmSRxjxt8RFCCTZmJFXxYFEa7F2ggv13O1ADf8Ah2T+xL/0ReP/AMLj4i//ADWUANf/AIJj/sSupX/hTEYDcN/xW3xBcMp6qyy+KpEKsOCCp9iDzQB9a/C74W+B/g14L0z4e/DnRI/D3hLR5tRm07S457i6Fu+qahc6ndZuLuWe6mzc3UgRp5pZFiWOMu2wEgHoNABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQB//9k=';
    });
}

// Forbidden tags for text replacement
const forbiddenTags = new Set(['textarea', 'input', 'script', 'noscript', 'template', 'style']);

// Check if a node is forbidden
function isForbiddenNode(node) {
    return node.isContentEditable || forbiddenTags.has(node.tagName?.toLowerCase());
}

// Handle text node replacement
function handleTextNode(textNode) {
    const originalText = textNode.nodeValue;
    const replacedText = replaceTextContent(originalText);
    if (originalText !== replacedText) {
        textNode.nodeValue = replacedText;
    }
}

// Walk the DOM and replace text nodes
function traverseDOM(rootNode) {
    const walker = document.createTreeWalker(
        rootNode,
        NodeFilter.SHOW_TEXT,
        {
            acceptNode: node =>
                /^(STYLE|SCRIPT)$/.test(node.parentElement.tagName) || /^\s*$/.test(node.data)
                    ? NodeFilter.FILTER_REJECT
                    : NodeFilter.FILTER_ACCEPT,
        }
    );

    let node;
    while ((node = walker.nextNode())) {
        if (!isForbiddenNode(node.parentNode)) {
            handleTextNode(node);
        }
    }
}

// Handle added nodes in mutations
function handleMutations(mutations) {
    mutations.forEach(({ addedNodes }) => {
        addedNodes.forEach(node => {
            if (node.nodeType === Node.TEXT_NODE) {
                handleTextNode(node);
            } else {
                traverseDOM(node);
            }
        });
    });

    replaceImages(); // Ensure images are updated
}

// Initialize DOM traversal and mutation observer
function initializeObserver(document) {
    const observerConfig = { characterData: true, childList: true, subtree: true };

    traverseDOM(document.body);
    document.title = replaceTextContent(document.title);

    const bodyObserver = new MutationObserver(mutations => handleMutations(mutations));
    bodyObserver.observe(document.body, observerConfig);

    const head = document.querySelector('head');
    if (head) {
        const headObserver = new MutationObserver(mutations => handleMutations(mutations));
        headObserver.observe(head, observerConfig);
    }
}

// Start script if the language is supported
if (supportedLanguages.includes(htmlLang)) {
    browser.i18n.getAcceptLanguages().then(languages => {
        currentLang = htmlLang.startsWith('en') ? 'en' : 'en'; // Fallback to 'en'
        initializeObserver(document);
    });
}
